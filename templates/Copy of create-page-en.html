<!doctype html>

<html lang="en">

<style type="text/css">

body {
font-family: sans-serif;
width: 800px;
margin: 0 auto;
}

textarea {
width: 800px;
height: 200px;
resize: none;
overflow: hidden;
min-height: 25px;
}

.error {
color: red;
}
</style>


<head>
	<meta charset="utf-8">
	<link rel="shortcut icon" href="/favicon0.ico">
	<title>py.gl - Put it online</title>
	<meta name="description" content="pygl page - create free micro pages">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style type="text/css"></style>
	<script src='https://www.google.com/recaptcha/api.js'></script>
	<script>
	function handleFiles()
	{
	    var file = document.getElementById('input').files[0];
		if(file != undefined) {
		if(file.type.match(/image.*/)){
	    // Create an image
	    var image = new Image();
	    image.src = 
	    image.onload = function()
	    {
	     
	        //var canvas = $("<canvas>", {"id":"testing"})[0];
	        //var ctx = canvas.getContext("2d");
	        //ctx.drawImage(img, 0, 0);
	
	        var MAX_WIDTH = 640;
	        var MAX_HEIGHT = 640;
	        var width = image.width;
	        var height = image.height;
	        
	        document.getElementById("demo").innerHTML = file.type;
	        document.getElementById("demo2").innerHTML = image.width;
	
	        if (width > height) {
	          if (width > MAX_WIDTH) {
	            height *= MAX_WIDTH / width;
	            width = MAX_WIDTH;
	          }
	        } else {
	          if (height > MAX_HEIGHT) {
	            width *= MAX_HEIGHT / height;
	            height = MAX_HEIGHT;
	          }
	        }
	        var canvas = document.createElement("canvas");
	        canvas.width = width;
	        canvas.height = height;
	        var ctx = canvas.getContext("2d");
	        ctx.drawImage(image, 0, 0, width, height);
	
	        var dataurl = canvas.toDataURL("image/jpeg");
	        
	        

			document.getElementById("demo").innerHTML = dataurl;
			
			var fd = new FormData();
			fd.append("name", "paul");
			fd.append("dataurl", dataurl);
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "https://pygl-page.appspot.com/r/upload");
			//xhr.open("POST", "https://8080-dot-1957920-dot-devshell.appspot.com/r/upload");
			
			xhr.onload = function () {
			  if (xhr.readyState === 4) {
			    if (xhr.status === 200) {
			      console.log(xhr.responseText);
			      document.getElementById("demo").innerHTML = xhr.responseText;
			      document.getElementById("image_id0").value = xhr.responseText;
			      document.getElementById('preview_image').src = dataurl;
			    } else {
			      console.error(xhr.statusText);
			      document.getElementById("demo").innerHTML = xhr.statusText;
			    }
			  }
			};
			
			xhr.send(fd);
	        
	    }
	    
	    
	    // Create a file reader
	    var reader = new FileReader();
	    // Set the image once loaded into file reader
	    reader.onload = function()
	    {
	    	//document.getElementById('preview_image').src = event.target.result;
	    	//var image = document.createElement("img");
	    	
	        image.src = event.target.result;
	      
	    }
	    // Load files into file reader
	    reader.readAsDataURL(file);
	    }
	    else
	    {
	    document.getElementById("demo").innerHTML = "not image type";
	    }
	    }
	    else
	    {
	    document.getElementById("demo").innerHTML = "file undefined";
	    }
	    
	}
	
function autosize(element) {

    var scrollLeft = window.pageXOffset ||
   (document.documentElement || document.body.parentNode || document.body).scrollLeft;

   var scrollTop  = window.pageYOffset ||
   (document.documentElement || document.body.parentNode || document.body).scrollTop;

    element.style.height = "5px";
    element.style.height = (element.scrollHeight + 10)+"px";
    
   window.scrollTo(scrollLeft, scrollTop);
    
}
	
	

	
	</script>
</head>

<body>
	<form id="create-form" method="POST" enctype="multipart/form-data">
		<div>
			<label>
			<p  id="demo">para</p>
			<p  id="demo2">para</p>
				<p>
				<input type="text" name="page_title" placeholder="Title" value="{{page_title}}">
				{% if err_title == True %}
				Please insert a title, text or image
				{% endif %}
				</p>
			</label>
		</div>
		<div>
			<label>

				<p>
				 <textarea style="font: 16px Verdana;" name="page_text0" oninput="autosize(this)" placeholder="Text&#10;&#10;&#10;Tips:&#10;&#10;- *Text between asterisks* will be displayed in bold&#10;&#10;- Create multiple pygl-pages and link them with:&#10;py.gl/my-page-2" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}">{{page_text0}}</textarea>
				</p>
			</label>
		</div>
		<div>
			<label>
				Image:
				<input type="file" name="page_image" accept="image/*" id="input" onchange="handleFiles()">
				<input type="hidden" name="image_id0" id="image_id0">
			</label>
		</div>
		<img id="preview_image" src="" alt=""/>
		<div>
			<label>
				<p>
				 <textarea style="font: 16px Verdana;" name="page_text1" oninput="autosize(this)" placeholder="Text" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}">{{page_text1}}</textarea>
				</p>
			</label>
		</div>
		<div>
			<label>
				<p>Url:</p>
				py.gl / <input type="text" name="page_uri" placeholder="my-page" value="{{page_uri}}">
				{% if err_uri_not_available == True %}
				Sorry, this page name is not available
				{% endif %}
				{% if err_uri_invalid == True %}
				Invalid page name (name must be between 2 and 160 characters and may contain a-z, 0-9 and -)
				{% endif %}
			</label>
		</div>
		<div>
			<label>
				Comments active:
				<input type="checkbox" name="comments_active" value="comments_active" {{comments_checked}}>
			</label>
		</div>
		<div>
		<p>
			<label>
				Password:
				<input type="password" name="page_password" placeholder="set password">
				{% if err_passwort_format == True %}
				Invalid password (must be at least 6 characters long and may contain A-Z, a-z, 0-9 and @#$%^!?&+=)
				{% endif %}
				<br>
			</label>
			<label>
				Retype password:
				<input type="password" name="page_repassword" placeholder="retype password">
				{% if err_password_retype == True %}
				The retyped password did not match
				{% endif %}
			</label>
		</p>
		</div>
		<div class="g-recaptcha" data-sitekey="6LdFmiEUAAAAAGrbm1QfbqbKjhfBpjCXHnsY7vPi"></div>
		{% if err_captcha == True %}
		Please check the 'I am not a robot' box
		{% endif %}
		<div>
		 <input type="submit" value="Put it online"/>
		</div>
	</form>
</body>
</html>
